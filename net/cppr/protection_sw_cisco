!
$hostname
$operator_pass
$domain           
$pref
$mgmt_net
$mgmt_host
!
$SNMP_srv_host
$SNMP_comm

############## выключаем&включаем ############## 
!
no aaa authentication login ssh local enable
no username operator
username operator priv 15 sec $operator_pass
!
hostname $hostname
!
system mtu 1600
no service tcp-small-servers
no service udp-small-servers
no service finger
no ip finger
no service config
no service pad
no ip source-route
no ip http server
no ip http secure-server
no ip bootp server
no ip domain-lookup
no cdp run
no ip gratuitous-arps
no ip identd
no service dhcp
!
login on-failure log
login on-success log
!
service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime localtime
service timestamps log datetime localtime
service password-encryption
!
ip ssh source-interface Vlan1031
ip radius source-interface Vlan1031 
logging source-interface Vlan1031
ntp source Vlan1031 
!
mac-address-table notification mac-move
mac address-table notification threshold limit 50 interval 900
!
no route-map Radius-Local
no ip local policy route-map Radius-Local
!
logging count
logging buffered 512000
no logging console
!
aaa authentication login console local
aaa authentication login RMI group radius local
!
vtp mode transparent
ip subnet-zero
!
ip domain-name $domain
!
vlan internal allocation policy ascending
!
!
############## ARP filtering ##############
!
ip arp inspection vlan 3-4,7,10-11,15
ip arp inspection vlan 3-4,7,10-11,15 logging acl-match matchlog
ip arp inspection vlan 3-4,7,10-11,15 logging arp-probe
ip arp inspection validate ip 
ip arp inspection log-buffer entries 10
ip arp inspection filter ARP_vlan vlan  3 static
!
no ip arp inspection validate ip
errdisable recovery cause arp-inspection
!
arp access-list ARP_vlan
 permit response ip host $pref any mac host $mac any 
 deny response ip host $pref any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
!
############## dhcp snooping ##############
!
ip dhcp snooping vlan 3-4,7,10-11,15
ip dhcp snooping
ip arp inspection vlan 4,10-11,15
ip arp inspection vlan 4,10-11,15 logging acl-match matchlog
ip arp inspection vlan 4,10-11,15 logging arp-probe
ip arp inspection validate ip 
ip arp inspection log-buffer entries 10
ip arp inspection filter ARP_vlan vlan  4 static
!
############## ACL's ##############
!
no access-list 1301
no access-list 101
!
mac access-list extended gw_fw
    deny   0000.5e00.0100 0000.0000.00ff any
    deny   1111.1111.0000 0000.0000.ffff any
    deny   2222.2222.0000 0000.0000.ffff any
    permit any any
!
ip access-list extended mgmt_fw
    permit ip $mgmt_net 0.0.0.255 any
    permit tcp host $mgmt_host any eq 22
    permit icmp $mgmt_net 0.0.0.255 any
    permit icmp host $mgmt_host any
    deny ip any 224.0.0.0 0.255.255.255
    deny ip any any log
!
access-list 1301 remark --ACL to SNMP--
access-list 1301 permit $SNMP_srv_host
!
access-list 101 remark --ACL_for_CLI--
access-list 101 permit ip host $mgmt_host any
!
############## vty ############## 
!
line con 0
    exec-timeout 600 0
    login authentication console
!
line vty 0 4
    access-class 101 in vrf-also
    exec-timeout 600 0
    login authentication RMI
    transport input ssh
line vty 5 15
    access-class 101 in vrf-also
    transport input none
!
############## snmp config ##############
!
no snmp-server
snmp-server community fsonetro RO 1301
snmp-server trap link ietf
snmp-server trap-source Vlan1031
snmp-server system-shutdown
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps transceiver all
snmp-server enable traps tty
snmp-server enable traps cluster
snmp-server enable traps entity
snmp-server enable traps cpu threshold
snmp-server enable traps rep
snmp-server enable traps vtp
snmp-server enable traps vlancreate
snmp-server enable traps vlandelete
snmp-server enable traps flash insertion removal
snmp-server enable traps envmon fan shutdown supply temperature status
snmp-server enable traps storm-control trap-rate 1
snmp-server enable traps mac-notification threshold
snmp-server enable traps mac-notification move
snmp-server enable traps port-security trap-rate 900
snmp-server enable traps cef resource-failure peer-state-change peer-fib-state-change inconsistency
snmp-server enable traps config-copy
snmp-server enable traps config
snmp-server enable traps config-ctid
snmp-server enable traps event-manager
snmp-server enable traps ipmulticast
snmp-server enable traps msdp
snmp-server enable traps pim neighbor-change rp-mapping-change invalid-pim-message
snmp-server enable traps bridge newroot topologychange
snmp-server enable traps stpx inconsistency root-inconsistency loop-inconsistency
snmp-server enable traps syslog
snmp-server enable traps rtr
snmp-server enable traps vlan-membership
snmp-server enable traps erdisable
snmp-server host $SNMP_srv_host version 2c $SNMP_comm 
snmp-server host $SNMP_srv_host version 2c $SNMP_comm
!
############## interfaces ##############
!
interface Vlan10
 ip access-group mgmt_fw in
 no ip redirects
 no ip unreachables
 no ip proxy-arp
!
interface GigabitEthernet0/24
    description --RT_tr--
    switchport trunk encapsulation dot1q
    switchport trunk allowed vlan 
    switchport mode trunk
    switchport nonegotiate
    ip arp inspection trust
    no cdp enable
!
interface GigabitEthernet0/1
    switchport trunk encapsulation dot1q
    switchport trunk native vlan 3333
    switchport trunk allowed vlan 
    switchport mode trunk
    switchport nonegotiate
    switchport port-security maximum 10
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 10.00
    storm-control multicast level 10.00
    storm-control action trap
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
interface GigabitEthernet0/28
    switchport trunk encapsulation dot1q
    switchport trunk native vlan 3333
    switchport trunk allowed vlan 
    switchport mode trunk
    switchport nonegotiate
    switchport port-security maximum 100
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
interface GigabitEthernet0/3
    switchport mode access
    switchport nonegotiate
    switchport port-security maximum 10
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
#shut interface
interface GigabitEthernet0/15
    switchport port-security maximum 10
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!

