!
$hostname
$operator_pass
$domain             #SW-3560.vladivostok.fsonet
$pref
$ussi_pref
!
############## выключаем&включаем ############## 
!
no aaa authentication login ssh local enable
no username operator
username operator priv 15 sec $operator_pass
!
hostname $hostname
!
system mtu 1600
no service tcp-small-servers
no service udp-small-servers
no service finger
no ip finger
no service config
no service pad
no ip source-route
no ip http server
no ip http secure-server
no ip bootp server
no ip domain-lookup
no cdp run
no ip gratuitous-arps
no ip identd
no service dhcp
!
login on-failure log
login on-success log
!
service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime localtime
service timestamps log datetime localtime
service password-encryption
!
ip ssh source-interface Vlan1031
ip radius source-interface Vlan1031 
logging source-interface Vlan1031
ntp source Vlan1031 
!
mac-address-table notification mac-move
mac address-table notification threshold limit 50 interval 900
!
no route-map Radius-Local
no ip local policy route-map Radius-Local
!
logging count
logging buffered 512000
no logging console
!
aaa authentication login console local
aaa authentication login TSPK group radius local
!
vtp mode transparent
ip subnet-zero
!
ip domain-name $domain
!
archive
    log config
    hidekeys
    path scp://archiveuser:archiveuser@10.30.1.20://home/archiveuser/archiveconfig/$domain/$h$t
    write-memory
!
vlan internal allocation policy ascending
!
ip classless
ip route 0.0.0.0 0.0.0.0 10.31.$pref.1
!
############## ARP filtering ##############
!
ip arp inspection vlan 3-4,7,10-11,15
ip arp inspection vlan 3-4,7,10-11,15 logging acl-match matchlog
ip arp inspection vlan 3-4,7,10-11,15 logging arp-probe
ip arp inspection validate ip 
ip arp inspection log-buffer entries 10
ip arp inspection filter ARP_vlan3 vlan  3 static
ip arp inspection filter ARP_vlan4 vlan  4 static
ip arp inspection filter ARP_vlan7 vlan  7 static
ip arp inspection filter ARP_vlan10 vlan  10 static
ip arp inspection filter ARP_vlan11 vlan  11 static
ip arp inspection filter ARP_vlan15 vlan  15 static
!
no ip arp inspection validate ip
errdisable recovery cause arp-inspection
!
arp access-list ARP_vlan10
 permit response ip host 10.1.$pref.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.1.$pref.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
arp access-list ARP_vlan11
 permit response ip host 10.$pref.11.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.$pref.11.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
arp access-list ARP_vlan15
 permit response ip host 10.$pref.10.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.$pref.10.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
arp access-list ARP_vlan3
 permit response ip host 10.3.$pref.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.3.$pref.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
arp access-list ARP_vlan4
 permit response ip host 10.4.$pref.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.4.$pref.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
arp access-list ARP_vlan7
 permit response ip host 10.7.$pref.1 any mac host 4c00.8230.8282 any 
 deny response ip host 10.7.$pref.1 any mac any any log
 permit request ip any mac any 
 permit response ip any any mac any any 
!
############## dhcp snooping ##############
!
ip dhcp snooping vlan 3-4,7,10-11,15
ip dhcp snooping
ip arp inspection vlan 4,10-11,15
ip arp inspection vlan 4,10-11,15 logging acl-match matchlog
ip arp inspection vlan 4,10-11,15 logging arp-probe
ip arp inspection validate ip 
ip arp inspection log-buffer entries 10
ip arp inspection filter ARP_vlan4 vlan  4 static
ip arp inspection filter ARP_vlan10 vlan  10 static
ip arp inspection filter ARP_vlan11 vlan  11 static
ip arp inspection filter ARP_vlan15 vlan  15 static
!
############## ACL's ##############
!
no access-list 1301
no access-list 101
!
mac access-list extended gw_fw
    deny   0000.5e00.0100 0000.0000.00ff any
    deny   a8d0.e555.0000 0000.0000.ffff any
    deny   24e9.b36d.0000 0000.0000.ffff any
    permit any any
!
ip access-list extended mgmt_fw
    permit ip 10.30.1.0 0.0.0.255 any
    permit tcp host 10.31.$ussi_pref.1 any eq 22
    permit icmp 10.30.1.0 0.0.0.255 any
    permit icmp host 10.31.$ussi_pref.1 any
    deny ip any 224.0.0.0 0.255.255.255
    deny ip any any log
!
access-list 1301 remark --ACL to SNMP--
access-list 1301 permit 10.30.1.17
access-list 1301 permit 10.30.1.13
access-list 1301 permit 10.30.1.14
access-list 1301 permit 10.30.1.204
access-list 1301 permit 10.30.1.144
!
access-list 101 remark --ACL_for_CLI--
access-list 101 permit ip host 10.31.$ussi_pref.1 any
access-list 101 permit ip host 10.30.1.1 any
access-list 101 permit ip host 10.30.1.71 any
access-list 101 permit ip host 10.30.1.59 any
access-list 101 permit ip host 10.30.1.74 any
access-list 101 permit ip host 10.30.1.51 any
access-list 101 permit ip host 10.30.1.161 any
access-list 101 permit ip host 10.30.1.60 any
access-list 101 permit ip host 10.30.1.67 any
access-list 101 permit ip host 10.30.1.78 any
access-list 101 permit ip host 10.30.1.204 any
access-list 101 permit ip host 10.30.1.29 any
access-list 101 permit ip host 10.30.1.144 any
access-list 101 permit ip host 10.30.1.56 any
!
############## vty ############## 
!
line con 0
    exec-timeout 600 0
    login authentication console
!
line vty 0 4
    access-class 101 in vrf-also
    exec-timeout 600 0
    login authentication TSPK
    transport input ssh
line vty 5 15
    access-class 101 in vrf-also
    transport input none
!
############## snmp config ##############
!
no snmp-server
snmp-server community fsonetro RO 1301
snmp-server trap link ietf
snmp-server trap-source Vlan1031
snmp-server system-shutdown
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps transceiver all
snmp-server enable traps tty
snmp-server enable traps cluster
snmp-server enable traps entity
snmp-server enable traps cpu threshold
snmp-server enable traps rep
snmp-server enable traps vtp
snmp-server enable traps vlancreate
snmp-server enable traps vlandelete
snmp-server enable traps flash insertion removal
snmp-server enable traps envmon fan shutdown supply temperature status
snmp-server enable traps storm-control trap-rate 1
snmp-server enable traps mac-notification threshold
snmp-server enable traps mac-notification move
snmp-server enable traps port-security trap-rate 900
snmp-server enable traps cef resource-failure peer-state-change peer-fib-state-change inconsistency
snmp-server enable traps config-copy
snmp-server enable traps config
snmp-server enable traps config-ctid
snmp-server enable traps event-manager
snmp-server enable traps ipmulticast
snmp-server enable traps msdp
snmp-server enable traps pim neighbor-change rp-mapping-change invalid-pim-message
snmp-server enable traps bridge newroot topologychange
snmp-server enable traps stpx inconsistency root-inconsistency loop-inconsistency
snmp-server enable traps syslog
snmp-server enable traps rtr
snmp-server enable traps vlan-membership
snmp-server enable traps erdisable
snmp-server host 10.30.1.17 version 2c fsonetro 
snmp-server host 10.30.1.204 version 2c fsonetro 
!
############## interfaces ##############
!
interface Vlan1031
 ip access-group mgmt_fw in
 no ip redirects
 no ip unreachables
 no ip proxy-arp
!
interface GigabitEthernet0/24
    description --RT_tr--
    switchport trunk encapsulation dot1q
    switchport trunk allowed vlan 3,4,7,10,11,15,101,116,119,377,381,500,520,1031
    switchport mode trunk
    switchport nonegotiate
    ip arp inspection trust
    no cdp enable
!
interface GigabitEthernet0/1
    description --L2_RTK_HBR_988000--
    switchport trunk encapsulation dot1q
    switchport trunk native vlan 3333
    switchport trunk allowed vlan 101
    switchport mode trunk
    switchport nonegotiate
    switchport port-security maximum 10
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 10.00
    storm-control multicast level 10.00
    storm-control action trap
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
interface GigabitEthernet0/28
    description --SW_ADMINISTRACIYA_tr--
    switchport trunk encapsulation dot1q
    switchport trunk native vlan 3333
    switchport trunk allowed vlan 4,10,15,381
    switchport mode trunk
    switchport nonegotiate
    switchport port-security maximum 100
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
interface GigabitEthernet0/3
    description --KVS--
    switchport access vlan 10
    switchport mode access
    switchport nonegotiate
    switchport port-security maximum 10
    switchport port-security
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!
#shut interface
interface GigabitEthernet0/15
    switchport port-security maximum 10
    switchport port-security violation restrict
    ip arp inspection limit none
    storm-control broadcast level 5.00
    storm-control multicast level 0.10
    storm-control action trap
    no cdp enable
    spanning-tree portfast
    spanning-tree bpdufilter enable
!

